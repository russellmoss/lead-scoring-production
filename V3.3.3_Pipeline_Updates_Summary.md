# V3.3.3 Pipeline Updates Summary
**Date:** January 2026  
**Status:** ✅ **ALL PIPELINE FILES UPDATED**

---

## Files Updated in `pipeline/` Directory

### ✅ SQL Files

1. **`pipeline/sql/January_2026_Lead_List_V3_V4_Hybrid.sql`**
   - ✅ Already updated during implementation
   - ✅ Added T1B_PRIME tier logic (first priority)
   - ✅ Added T1G_ENHANCED and T1G_REMAINDER tiers
   - ✅ Added `firm_custodian` join and `has_portable_custodian` field
   - ✅ Updated expected conversion rates
   - ✅ Updated priority ranks
   - ✅ Updated header to V3.3.3

2. **`pipeline/January_2026_Lead_List_V3_V4_Hybrid.sql`** (Root copy)
   - ✅ **UPDATED** - Synced with `pipeline/sql/` version
   - ✅ Now matches V3.3.3 implementation

### ✅ Python Scripts

3. **`pipeline/scripts/export_lead_list.py`**
   - ✅ **UPDATED** - Added new tiers to `tier1_tiers` list
   - ✅ Now includes: T1B_PRIME, T1G_ENHANCED, T1G_REMAINDER
   - ✅ Updated tier logic in `calculate_excluded_from_scores` function

---

## Changes Made

### 1. Root SQL File Sync

**Action:** Copied updated SQL from `pipeline/sql/` to root `pipeline/` directory

**Reason:** Both files should be in sync. The root file is likely a backup/reference copy.

**Changes:**
- Header updated to V3.3.3
- T1B_PRIME tier logic added
- T1G_ENHANCED and T1G_REMAINDER tiers added
- All conversion rates and priority ranks updated

---

### 2. Export Script Tier List Update

**File:** `pipeline/scripts/export_lead_list.py`

**Changes Made:**

#### Updated `tier1_tiers` List (Line 285)
**Before:**
```python
tier1_tiers = ['TIER_1A_PRIME_MOVER_CFP', 'TIER_1B_PRIME_MOVER_SERIES65', 
              'TIER_1_PRIME_MOVER', 'TIER_1F_HV_WEALTH_BLEEDER']
```

**After:**
```python
tier1_tiers = ['TIER_1B_PRIME_ZERO_FRICTION', 'TIER_1A_PRIME_MOVER_CFP', 
              'TIER_1G_ENHANCED_SWEET_SPOT', 'TIER_1B_PRIME_MOVER_SERIES65',
              'TIER_1G_GROWTH_STAGE', 'TIER_1_PRIME_MOVER', 'TIER_1F_HV_WEALTH_BLEEDER']
```

**Purpose:** This list is used to check for V3/V4 disagreement (Tier 1 leads with V4 < 70th percentile should be excluded). The new tiers need to be included in this check.

#### Updated Tier Logic in `calculate_excluded_from_scores` (Line 133)
**Added:** T1B_PRIME tier logic to the simplified tier reconstruction

**Note:** This function is a fallback for calculating excluded leads when the excluded table doesn't exist. It uses simplified tier logic, so the T1B_PRIME addition ensures excluded leads are correctly identified.

---

## Files That Don't Need Updates

### ✅ No Changes Needed

1. **`pipeline/scripts/execute_january_lead_list.py`**
   - ✅ No changes needed - Just executes SQL file from `pipeline/sql/`
   - ✅ Already points to correct file

2. **`pipeline/scripts/score_prospects_monthly.py`**
   - ✅ No changes needed - Uses `lead_scores_v3` table (already regenerated)

3. **Other SQL files in `pipeline/sql/`:**
   - ✅ `create_excluded_firms_table.sql` - No tier logic
   - ✅ `create_excluded_firm_crds_table.sql` - No tier logic
   - ✅ `manage_excluded_firms.sql` - No tier logic
   - ✅ `v4_prospect_features.sql` - V4 features only
   - ✅ `recycling/recyclable_pool_master_v2.1.sql` - Separate recycling logic

---

## Validation Checklist

- [x] Root SQL file synced with `pipeline/sql/` version
- [x] Export script tier list updated with new tiers
- [x] Export script tier logic updated for T1B_PRIME
- [x] All V3.3.3 tiers included in V3/V4 disagreement check
- [x] No other pipeline files need updates

---

## Impact

### Export Script Changes

**Before V3.3.3:**
- Only 4 Tier 1 tiers checked for V3/V4 disagreement
- T1B_PRIME, T1G_ENHANCED, T1G_REMAINDER would be missed

**After V3.3.3:**
- All 7 Tier 1 tiers checked for V3/V4 disagreement
- New tiers properly included in exclusion logic
- More accurate V3/V4 disagreement filtering

---

## Next Steps

1. ✅ **SQL files updated** - Both root and `pipeline/sql/` versions are in sync
2. ✅ **Export script updated** - New tiers included in validation logic
3. ⏭️ **Test export script** - Run export to verify new tiers are handled correctly
4. ⏭️ **Monitor production** - Track that new tiers appear in exported lead lists

---

## Summary

**Status:** ✅ **ALL PIPELINE FILES UPDATED**

All necessary files in the `pipeline/` directory have been updated for V3.3.3:

1. ✅ Root SQL file synced
2. ✅ Export script tier list updated
3. ✅ Export script tier logic updated

**No further changes needed in the pipeline directory.**

---

*Updates completed: January 2026*

